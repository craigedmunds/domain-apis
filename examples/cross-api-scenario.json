{
  "scenario": "Complete Tax Payment Journey",
  "description": "This example demonstrates a complete journey through the UK tax system APIs, showing how a taxpayer files a tax return, receives an assessment, and makes a payment that is allocated to the tax return.",
  "resources": {
    "taxpayer": {
      "id": "TP123456",
      "type": "taxpayer",
      "nino": "AB123456C",
      "name": {
        "title": "Mr",
        "firstName": "John",
        "middleNames": "Robert",
        "lastName": "Smith"
      },
      "address": {
        "line1": "10 Downing Street",
        "line2": "Westminster",
        "line3": "London",
        "postcode": "SW1A 2AA",
        "country": "GB"
      },
      "dateOfBirth": "1980-05-15",
      "_links": {
        "self": "http://localhost:8080/api/taxpayer/v1/taxpayers/TP123456",
        "taxReturns": {
          "href": "http://localhost:8080/api/income-tax/v1/tax-returns?taxpayerId=TP123456",
          "type": "collection",
          "title": "Tax returns for this taxpayer"
        },
        "payments": {
          "href": "http://localhost:8080/api/payment/v1/payments?taxpayerId=TP123456",
          "type": "collection",
          "title": "Payments made by this taxpayer"
        }
      }
    },
    "taxReturn": {
      "id": "TR20230001",
      "type": "tax-return",
      "taxpayerId": "TP123456",
      "taxYear": "2023-24",
      "period": {
        "startDate": "2023-04-06",
        "endDate": "2024-04-05"
      },
      "status": "assessed",
      "totalIncome": {
        "amount": 50000.00,
        "currency": "GBP"
      },
      "taxDue": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "_links": {
        "self": "http://localhost:8080/api/income-tax/v1/tax-returns/TR20230001",
        "taxpayer": {
          "href": "http://localhost:8080/api/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who filed this return"
        },
        "assessments": {
          "href": "http://localhost:8080/api/income-tax/v1/tax-returns/TR20230001/assessments",
          "type": "collection",
          "title": "Assessments for this return"
        },
        "allocations": {
          "href": "http://localhost:8080/api/payment/v1/allocations?taxReturnId=TR20230001",
          "type": "collection",
          "title": "Payment allocations for this return"
        }
      }
    },
    "assessment": {
      "id": "AS20230001",
      "type": "assessment",
      "taxReturnId": "TR20230001",
      "assessmentDate": "2024-01-15T10:30:00Z",
      "taxDue": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "dueDate": "2024-01-31",
      "_links": {
        "self": "http://localhost:8080/api/income-tax/v1/assessments/AS20230001",
        "taxReturn": {
          "href": "http://localhost:8080/api/income-tax/v1/tax-returns/TR20230001",
          "type": "tax-return",
          "title": "Tax return for this assessment"
        }
      }
    },
    "payment": {
      "id": "PM20230001",
      "type": "payment",
      "taxpayerId": "TP123456",
      "amount": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "paymentDate": "2024-01-31",
      "paymentMethod": "bank-transfer",
      "reference": "TAX-2023-001",
      "status": "cleared",
      "_links": {
        "self": "http://localhost:8080/api/payment/v1/payments/PM20230001",
        "taxpayer": {
          "href": "http://localhost:8080/api/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who made this payment"
        },
        "allocations": {
          "href": "http://localhost:8080/api/payment/v1/payments/PM20230001/allocations",
          "type": "collection",
          "title": "Allocations for this payment"
        }
      }
    },
    "paymentAllocation": {
      "id": "PA20230001",
      "type": "payment-allocation",
      "paymentId": "PM20230001",
      "taxReturnId": "TR20230001",
      "amount": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "allocationDate": "2024-01-31T14:30:00Z",
      "_links": {
        "self": "http://localhost:8080/api/payment/v1/allocations/PA20230001",
        "payment": {
          "href": "http://localhost:8080/api/payment/v1/payments/PM20230001",
          "type": "payment",
          "title": "Payment being allocated"
        },
        "taxReturn": {
          "href": "http://localhost:8080/api/income-tax/v1/tax-returns/TR20230001",
          "type": "tax-return",
          "title": "Tax return receiving the allocation"
        }
      }
    }
  },
  "relationshipGraph": {
    "description": "Visual representation of how resources relate across APIs",
    "relationships": [
      {
        "from": "Taxpayer (TP123456)",
        "to": "TaxReturn (TR20230001)",
        "relationship": "has filed",
        "apis": ["Taxpayer API", "Income Tax API"]
      },
      {
        "from": "TaxReturn (TR20230001)",
        "to": "Taxpayer (TP123456)",
        "relationship": "filed by",
        "apis": ["Income Tax API", "Taxpayer API"],
        "note": "Bidirectional relationship"
      },
      {
        "from": "TaxReturn (TR20230001)",
        "to": "Assessment (AS20230001)",
        "relationship": "has assessment",
        "apis": ["Income Tax API"]
      },
      {
        "from": "Assessment (AS20230001)",
        "to": "TaxReturn (TR20230001)",
        "relationship": "assesses",
        "apis": ["Income Tax API"],
        "note": "Bidirectional relationship"
      },
      {
        "from": "Taxpayer (TP123456)",
        "to": "Payment (PM20230001)",
        "relationship": "made payment",
        "apis": ["Taxpayer API", "Payment API"]
      },
      {
        "from": "Payment (PM20230001)",
        "to": "Taxpayer (TP123456)",
        "relationship": "paid by",
        "apis": ["Payment API", "Taxpayer API"],
        "note": "Bidirectional relationship"
      },
      {
        "from": "Payment (PM20230001)",
        "to": "PaymentAllocation (PA20230001)",
        "relationship": "allocated via",
        "apis": ["Payment API"]
      },
      {
        "from": "PaymentAllocation (PA20230001)",
        "to": "Payment (PM20230001)",
        "relationship": "allocates",
        "apis": ["Payment API"],
        "note": "Bidirectional relationship"
      },
      {
        "from": "PaymentAllocation (PA20230001)",
        "to": "TaxReturn (TR20230001)",
        "relationship": "allocated to",
        "apis": ["Payment API", "Income Tax API"]
      },
      {
        "from": "TaxReturn (TR20230001)",
        "to": "PaymentAllocation (PA20230001)",
        "relationship": "receives allocation",
        "apis": ["Income Tax API", "Payment API"],
        "note": "Bidirectional relationship"
      }
    ]
  },
  "traversalExamples": [
    {
      "name": "Find all tax returns for a taxpayer",
      "steps": [
        {
          "step": 1,
          "action": "GET /api/taxpayer/v1/taxpayers/TP123456",
          "result": "Get taxpayer resource with _links.taxReturns"
        },
        {
          "step": 2,
          "action": "Follow _links.taxReturns.href",
          "url": "http://localhost:8080/api/income-tax/v1/tax-returns?taxpayerId=TP123456",
          "result": "Get collection of tax returns for this taxpayer"
        }
      ]
    },
    {
      "name": "Find payments allocated to a tax return",
      "steps": [
        {
          "step": 1,
          "action": "GET /api/income-tax/v1/tax-returns/TR20230001",
          "result": "Get tax return resource with _links.allocations"
        },
        {
          "step": 2,
          "action": "Follow _links.allocations.href",
          "url": "http://localhost:8080/api/payment/v1/allocations?taxReturnId=TR20230001",
          "result": "Get collection of payment allocations for this tax return"
        },
        {
          "step": 3,
          "action": "Follow each allocation's _links.payment.href",
          "url": "http://localhost:8080/api/payment/v1/payments/PM20230001",
          "result": "Get the actual payment resource"
        }
      ]
    },
    {
      "name": "Complete journey: Taxpayer to Payment via Tax Return",
      "steps": [
        {
          "step": 1,
          "action": "GET /api/taxpayer/v1/taxpayers/TP123456",
          "result": "Get taxpayer resource"
        },
        {
          "step": 2,
          "action": "Follow _links.taxReturns.href",
          "url": "http://localhost:8080/api/income-tax/v1/tax-returns?taxpayerId=TP123456",
          "result": "Get tax returns collection"
        },
        {
          "step": 3,
          "action": "Select a tax return and follow _links.allocations.href",
          "url": "http://localhost:8080/api/payment/v1/allocations?taxReturnId=TR20230001",
          "result": "Get payment allocations for the tax return"
        },
        {
          "step": 4,
          "action": "Follow allocation's _links.payment.href",
          "url": "http://localhost:8080/api/payment/v1/payments/PM20230001",
          "result": "Get the payment resource"
        }
      ]
    },
    {
      "name": "Using include parameter to reduce requests",
      "steps": [
        {
          "step": 1,
          "action": "GET /api/taxpayer/v1/taxpayers/TP123456?include=taxReturns",
          "result": "Get taxpayer with embedded tax returns in _included field"
        },
        {
          "step": 2,
          "action": "Access _included.taxReturns array directly",
          "result": "No additional API call needed - tax returns already embedded"
        }
      ]
    }
  ],
  "urlValidation": {
    "description": "All relationship URLs are correctly formed",
    "checks": [
      {
        "check": "Absolute URLs",
        "status": "✓",
        "note": "All cross-API links use absolute URLs with scheme and host"
      },
      {
        "check": "Correct base paths",
        "status": "✓",
        "note": "Each API uses its designated base path (/api/taxpayer/v1, /api/income-tax/v1, /api/payment/v1)"
      },
      {
        "check": "Link metadata",
        "status": "✓",
        "note": "All links include type and title fields for context"
      },
      {
        "check": "Bidirectional relationships",
        "status": "✓",
        "note": "Resources link back to their related resources (e.g., TaxReturn links to Taxpayer, Taxpayer links to TaxReturns)"
      },
      {
        "check": "Collection vs single resource",
        "status": "✓",
        "note": "Links correctly indicate whether they point to a collection or single resource via the type field"
      }
    ]
  }
}
