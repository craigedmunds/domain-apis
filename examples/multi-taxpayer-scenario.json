{
  "scenario": "Multiple Taxpayers with Complex Relationships",
  "description": "This example demonstrates multiple taxpayers with various tax returns and payments, showing how the system handles multiple relationships and partial payments.",
  "taxpayers": [
    {
      "id": "TP123456",
      "type": "taxpayer",
      "nino": "AB123456C",
      "name": {
        "title": "Mr",
        "firstName": "John",
        "middleNames": "Robert",
        "lastName": "Smith"
      },
      "address": {
        "line1": "10 Downing Street",
        "line2": "Westminster",
        "line3": "London",
        "postcode": "SW1A 2AA",
        "country": "GB"
      },
      "dateOfBirth": "1980-05-15",
      "_links": {
        "self": "http://localhost:8080/taxpayer/v1/taxpayers/TP123456",
        "taxReturns": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns?taxpayerId=TP123456",
          "type": "collection",
          "title": "Tax returns for this taxpayer"
        },
        "payments": {
          "href": "http://localhost:8080/payment/v1/payments?taxpayerId=TP123456",
          "type": "collection",
          "title": "Payments made by this taxpayer"
        }
      }
    },
    {
      "id": "TP789012",
      "type": "taxpayer",
      "nino": "CD789012E",
      "name": {
        "firstName": "Jane",
        "lastName": "Doe"
      },
      "address": {
        "line1": "221B Baker Street",
        "postcode": "NW1 6XE",
        "country": "GB"
      },
      "dateOfBirth": "1975-08-22",
      "_links": {
        "self": "http://localhost:8080/taxpayer/v1/taxpayers/TP789012",
        "taxReturns": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns?taxpayerId=TP789012",
          "type": "collection",
          "title": "Tax returns for this taxpayer"
        },
        "payments": {
          "href": "http://localhost:8080/payment/v1/payments?taxpayerId=TP789012",
          "type": "collection",
          "title": "Payments made by this taxpayer"
        }
      }
    }
  ],
  "taxReturns": [
    {
      "id": "TR20230001",
      "type": "tax-return",
      "taxpayerId": "TP123456",
      "taxYear": "2023-24",
      "period": {
        "startDate": "2023-04-06",
        "endDate": "2024-04-05"
      },
      "status": "assessed",
      "totalIncome": {
        "amount": 50000.00,
        "currency": "GBP"
      },
      "taxDue": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "_links": {
        "self": "http://localhost:8080/income-tax/v1/tax-returns/TR20230001",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who filed this return"
        },
        "assessments": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20230001/assessments",
          "type": "collection",
          "title": "Assessments for this return"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/allocations?taxReturnId=TR20230001",
          "type": "collection",
          "title": "Payment allocations for this return"
        }
      }
    },
    {
      "id": "TR20220001",
      "type": "tax-return",
      "taxpayerId": "TP123456",
      "taxYear": "2022-23",
      "period": {
        "startDate": "2022-04-06",
        "endDate": "2023-04-05"
      },
      "status": "closed",
      "totalIncome": {
        "amount": 48000.00,
        "currency": "GBP"
      },
      "taxDue": {
        "amount": 7000.00,
        "currency": "GBP"
      },
      "_links": {
        "self": "http://localhost:8080/income-tax/v1/tax-returns/TR20220001",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who filed this return"
        },
        "assessments": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20220001/assessments",
          "type": "collection",
          "title": "Assessments for this return"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/allocations?taxReturnId=TR20220001",
          "type": "collection",
          "title": "Payment allocations for this return"
        }
      }
    },
    {
      "id": "TR20230002",
      "type": "tax-return",
      "taxpayerId": "TP789012",
      "taxYear": "2023-24",
      "period": {
        "startDate": "2023-04-06",
        "endDate": "2024-04-05"
      },
      "status": "submitted",
      "totalIncome": {
        "amount": 35000.00,
        "currency": "GBP"
      },
      "taxDue": {
        "amount": 3200.00,
        "currency": "GBP"
      },
      "_links": {
        "self": "http://localhost:8080/income-tax/v1/tax-returns/TR20230002",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP789012",
          "type": "taxpayer",
          "title": "Taxpayer who filed this return"
        },
        "assessments": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20230002/assessments",
          "type": "collection",
          "title": "Assessments for this return"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/allocations?taxReturnId=TR20230002",
          "type": "collection",
          "title": "Payment allocations for this return"
        }
      }
    }
  ],
  "payments": [
    {
      "id": "PM20230001",
      "type": "payment",
      "taxpayerId": "TP123456",
      "amount": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "paymentDate": "2024-01-31",
      "paymentMethod": "bank-transfer",
      "reference": "TAX-2023-001",
      "status": "cleared",
      "_links": {
        "self": "http://localhost:8080/payment/v1/payments/PM20230001",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who made this payment"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/payments/PM20230001/allocations",
          "type": "collection",
          "title": "Allocations for this payment"
        }
      }
    },
    {
      "id": "PM20220001",
      "type": "payment",
      "taxpayerId": "TP123456",
      "amount": {
        "amount": 7000.00,
        "currency": "GBP"
      },
      "paymentDate": "2023-01-31",
      "paymentMethod": "bank-transfer",
      "reference": "TAX-2022-001",
      "status": "cleared",
      "_links": {
        "self": "http://localhost:8080/payment/v1/payments/PM20220001",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP123456",
          "type": "taxpayer",
          "title": "Taxpayer who made this payment"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/payments/PM20220001/allocations",
          "type": "collection",
          "title": "Allocations for this payment"
        }
      }
    },
    {
      "id": "PM20230002",
      "type": "payment",
      "taxpayerId": "TP789012",
      "amount": {
        "amount": 3200.00,
        "currency": "GBP"
      },
      "paymentDate": "2024-02-15",
      "paymentMethod": "debit-card",
      "reference": "TAX-2023-002",
      "status": "cleared",
      "_links": {
        "self": "http://localhost:8080/payment/v1/payments/PM20230002",
        "taxpayer": {
          "href": "http://localhost:8080/taxpayer/v1/taxpayers/TP789012",
          "type": "taxpayer",
          "title": "Taxpayer who made this payment"
        },
        "allocations": {
          "href": "http://localhost:8080/payment/v1/payments/PM20230002/allocations",
          "type": "collection",
          "title": "Allocations for this payment"
        }
      }
    }
  ],
  "paymentAllocations": [
    {
      "id": "PA20230001",
      "type": "payment-allocation",
      "paymentId": "PM20230001",
      "taxReturnId": "TR20230001",
      "amount": {
        "amount": 7500.00,
        "currency": "GBP"
      },
      "allocationDate": "2024-01-31T14:30:00Z",
      "_links": {
        "self": "http://localhost:8080/payment/v1/allocations/PA20230001",
        "payment": {
          "href": "http://localhost:8080/payment/v1/payments/PM20230001",
          "type": "payment",
          "title": "Payment being allocated"
        },
        "taxReturn": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20230001",
          "type": "tax-return",
          "title": "Tax return receiving the allocation"
        }
      }
    },
    {
      "id": "PA20220001",
      "type": "payment-allocation",
      "paymentId": "PM20220001",
      "taxReturnId": "TR20220001",
      "amount": {
        "amount": 7000.00,
        "currency": "GBP"
      },
      "allocationDate": "2023-01-31T14:30:00Z",
      "_links": {
        "self": "http://localhost:8080/payment/v1/allocations/PA20220001",
        "payment": {
          "href": "http://localhost:8080/payment/v1/payments/PM20220001",
          "type": "payment",
          "title": "Payment being allocated"
        },
        "taxReturn": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20220001",
          "type": "tax-return",
          "title": "Tax return receiving the allocation"
        }
      }
    },
    {
      "id": "PA20230002",
      "type": "payment-allocation",
      "paymentId": "PM20230002",
      "taxReturnId": "TR20230002",
      "amount": {
        "amount": 3200.00,
        "currency": "GBP"
      },
      "allocationDate": "2024-02-15T14:30:00Z",
      "_links": {
        "self": "http://localhost:8080/payment/v1/allocations/PA20230002",
        "payment": {
          "href": "http://localhost:8080/payment/v1/payments/PM20230002",
          "type": "payment",
          "title": "Payment being allocated"
        },
        "taxReturn": {
          "href": "http://localhost:8080/income-tax/v1/tax-returns/TR20230002",
          "type": "tax-return",
          "title": "Tax return receiving the allocation"
        }
      }
    }
  ],
  "relationshipSummary": {
    "TP123456": {
      "taxpayer": "John Robert Smith (AB123456C)",
      "taxReturns": ["TR20230001 (2023-24)", "TR20220001 (2022-23)"],
      "payments": ["PM20230001 (£7,500)", "PM20220001 (£7,000)"],
      "totalPaid": "£14,500"
    },
    "TP789012": {
      "taxpayer": "Jane Doe (CD789012E)",
      "taxReturns": ["TR20230002 (2023-24)"],
      "payments": ["PM20230002 (£3,200)"],
      "totalPaid": "£3,200"
    }
  },
  "crossApiValidation": {
    "description": "Validation checks for cross-API relationships",
    "checks": [
      {
        "check": "All taxpayer IDs in tax returns exist in Taxpayer API",
        "status": "✓",
        "details": "TP123456 and TP789012 both exist"
      },
      {
        "check": "All taxpayer IDs in payments exist in Taxpayer API",
        "status": "✓",
        "details": "TP123456 and TP789012 both exist"
      },
      {
        "check": "All payment IDs in allocations exist in Payment API",
        "status": "✓",
        "details": "PM20230001, PM20220001, PM20230002 all exist"
      },
      {
        "check": "All tax return IDs in allocations exist in Income Tax API",
        "status": "✓",
        "details": "TR20230001, TR20220001, TR20230002 all exist"
      },
      {
        "check": "Bidirectional links are consistent",
        "status": "✓",
        "details": "All resources link back to their related resources"
      },
      {
        "check": "URL formats are correct",
        "status": "✓",
        "details": "All URLs use absolute paths with correct base URLs"
      }
    ]
  }
}
